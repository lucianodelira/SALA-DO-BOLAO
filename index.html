<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sala do Bol√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f1f;
  color:white;
}
.hidden{display:none}
.container{
  max-width:420px;
  margin:auto;
  margin-top:10vh;
  background:#1c1c3a;
  padding:20px;
  border-radius:12px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
input{background:#2a2a55;color:white}
button{
  background:#00c853;
  font-weight:bold;
  cursor:pointer;
}
#msg{color:#ff6b6b;margin-top:10px;text-align:center}

/* SALA */
header{
  background:#15152a;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
  padding:10px;
}
.card{
  background:#1c1c3a;
  padding:15px;
  border-radius:10px;
}
#lista div{
  border-bottom:1px solid #333;
  padding:5px;
}
iframe{
  width:100%;
  height:400px;
  border:none;
}
@media(max-width:900px){
  main{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h2>Entrar na Sala</h2>
  <input id="nome" placeholder="Seu nome">
  <input id="telefone" placeholder="Telefone (senha)">
  <button onclick="login()">Entrar</button>
  <div id="msg"></div>
</div>

<!-- SALA -->
<div id="salaBox" class="hidden">

<header>
  <div>üë• Ativos: <b id="total">0</b></div>
  <button onclick="toggleIframe()">üåê Abrir Site</button>
  <button onclick="logout()" style="background:#ff5252">Sair</button>
</header>

<div id="iframeBox" class="card hidden">
  <iframe src="https://www.zepitaco.com"></iframe>
</div>

<main>
  <div class="card">
    <h3>Participantes</h3>
    <div id="lista">Carregando...</div>
  </div>

  <div class="card">
    <h3>Bol√£o</h3>
    <button onclick="participar()">Participar do Bol√£o</button>
  </div>

  <div class="card">
    <h3>Exibir Bol√£o</h3>
    <button onclick="exibir()">Exibir Bol√£o</button>
  </div>
</main>

</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbz4kDF2DyJxIy7kH7-BTtkPhwFLDyXHAXiMVxlUnRdViYOjz9LUbh9AGJSLxpODG4_vMw/exec';
let monitor;

/******** LOGIN ********/
function login(){
  const nome = nomeInput.value.trim();
  const telefone = telefoneInput.value.trim();
  msg.innerText='';

  if(!nome || !telefone){
    msg.innerText='Preencha todos os campos';
    return;
  }

  fetch(`${API}?action=loginSala&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(telefone)}`)
    .then(r=>r.json())
    .then(res=>{
      if(res.success){
        sessionStorage.setItem('id',res.id);
        sessionStorage.setItem('nome',res.nome);
        entrarSala();
      }else{
        msg.innerText=res.message || 'Acesso negado';
      }
    });
}

/******** SALA ********/
function entrarSala(){
  loginBox.classList.add('hidden');
  salaBox.classList.remove('hidden');
  carregar();
  monitor = setInterval(verificarStatus,5000);
}

function verificarStatus(){
  const id = sessionStorage.getItem('id');
  fetch(`${API}?action=verificarStatus&id=${id}`)
    .then(r=>r.json())
    .then(res=>{
      if(!res.ativo){
        alert('Voc√™ foi removido da sala');
        logout();
      }
    });
}

function carregar(){
  fetch(API+'?action=totalAtivos')
    .then(r=>r.json())
    .then(d=>total.innerText=d.total);

  fetch(API+'?action=listarAtivos')
    .then(r=>r.json())
    .then(lista=>{
      listaDiv.innerHTML='';
      lista.forEach(p=>{
        listaDiv.innerHTML+=`<div>${p.id} - ${p.nome}</div>`;
      });
    });
}

function toggleIframe(){
  iframeBox.classList.toggle('hidden');
}

function participar(){
  alert('Participa√ß√£o registrada');
}

function exibir(){
  alert('Exibindo bol√£o');
}

function logout(){
  clearInterval(monitor);
  sessionStorage.clear();
  location.reload();
}

/******** AUTO LOGIN ********/
if(sessionStorage.getItem('id')){
  entrarSala();
}

/******** SHORTCUTS ********/
const nomeInput = document.getElementById('nome');
const telefoneInput = document.getElementById('telefone');
const msg = document.getElementById('msg');
const loginBox = document.getElementById('loginBox');
const salaBox = document.getElementById('salaBox');
const listaDiv = document.getElementById('lista');
const iframeBox = document.getElementById('iframeBox');
</script>

</body>
</html>
