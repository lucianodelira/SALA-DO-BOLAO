<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sala Exclusiva</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:#fff;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  width:100%;
  max-width:900px;
  background:rgba(28,28,44,.75);
  border-radius:20px;
  padding:30px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}
h2,h3{color:#00ff88;text-align:center}
.subtitle{text-align:center;margin-bottom:20px;color:#ccc}
input,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  margin-top:10px;
  font-size:15px;
}
input{background:#1f1f3a;color:#fff}
button{
  background:linear-gradient(90deg,#00c853,#00ff88);
  font-weight:700;
  cursor:pointer;
}
button:hover{opacity:.9}
.hidden{display:none}
.info-card{
  background:rgba(0,200,83,.08);
  border:1px solid rgba(0,200,83,.25);
  border-radius:16px;
  padding:20px;
  margin:15px 0;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
#listaParticipantes{
  max-height:220px;
  overflow:auto;
  font-size:14px;
}
.logout{
  background:linear-gradient(90deg,#ff5252,#ff7675);
  margin-top:20px;
}
iframe{
  width:100%;
  height:400px;
  border:none;
  border-radius:12px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h2>Entrar na Sala</h2>
  <p class="subtitle">Acesso exclusivo</p>
  <input id="nome" placeholder="Nome completo">
  <input id="telefone" placeholder="Telefone com DDD">
  <button onclick="login()">Entrar</button>
  <p id="msg" style="color:#ff6b6b;text-align:center;margin-top:10px"></p>
</div>

<!-- SALA -->
<div class="container hidden" id="salaBox">

  <!-- TOPO -->
  <div class="info-card">
    <h3>Participantes Ativos</h3>
    <h2 id="totalAtivos">0</h2>
    <button onclick="abrirIframe()">Abrir Site</button>
  </div>

  <!-- CORPO -->
  <div class="grid">
    <div class="info-card">
      <h3>ðŸ‘¥ Participantes</h3>
      <div id="listaParticipantes"></div>
    </div>

    <div class="info-card">
      <h3>ðŸŽ¯ BolÃ£o</h3>
      <button onclick="participarBolao()">Participar do BolÃ£o</button>
      <button onclick="exibirBolao()">Exibir BolÃ£o</button>
    </div>
  </div>

  <!-- IFRAME -->
  <div class="info-card hidden" id="iframeBox">
    <button class="logout" onclick="fecharIframe()">Fechar Aba</button>
    <iframe src="https://www.zepitaco.com"></iframe>
  </div>

  <button class="logout" onclick="logout()">Sair</button>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbz4kDF2DyJxIy7kH7-BTtkPhwFLDyXHAXiMVxlUnRdViYOjz9LUbh9AGJSLxpODG4_vMw/exec';
let monitorInterval=null;

function login(){
  const nome=nomeInput().value.trim();
  const tel=telefoneInput().value.trim();
  msg().innerText='';
  if(!nome||!tel){msg().innerText='Preencha tudo';return;}

  fetch(`${API_URL}?action=loginSala&nome=${encodeURIComponent(nome)}&telefone=${encodeURIComponent(tel)}`)
    .then(r=>r.json())
    .then(res=>{
      if(res.success){
        sessionStorage.setItem('userId',res.id);
        entrarSala();
      }else msg().innerText=res.message;
    });
}

function entrarSala(){
  loginBox().classList.add('hidden');
  salaBox().classList.remove('hidden');
  carregarSala();
  iniciarMonitoramento();
}

function carregarSala(){
  fetch(`${API_URL}?action=dashboard`)
    .then(r=>r.json())
    .then(res=>{
      totalAtivos.innerText=res.totalAtivos;
      listaParticipantes.innerHTML='';
      res.participantes.forEach(n=>listaParticipantes.innerHTML+=`â€¢ ${n}<br>`);
    });
}

function iniciarMonitoramento(){
  monitorInterval=setInterval(()=>{
    fetch(`${API_URL}?action=verificarStatus&id=${sessionStorage.getItem('userId')}`)
      .then(r=>r.json())
      .then(res=>{if(!res.ativo) logout(true)});
  },5000);
}

function abrirIframe(){iframeBox.classList.remove('hidden')}
function fecharIframe(){iframeBox.classList.add('hidden')}
function participarBolao(){alert('ParticipaÃ§Ã£o registrada')}
function exibirBolao(){alert('BolÃ£o em exibiÃ§Ã£o')}
function logout(force){
  clearInterval(monitorInterval);
  sessionStorage.clear();
  if(force) alert('Acesso encerrado');
  location.reload();
}

const nomeInput=()=>document.getElementById('nome');
const telefoneInput=()=>document.getElementById('telefone');
const msg=()=>document.getElementById('msg');
const loginBox=()=>document.getElementById('loginBox');
const salaBox=()=>document.getElementById('salaBox');

if(sessionStorage.getItem('userId')) entrarSala();
</script>

</body>
</html>
